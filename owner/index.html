<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ABR Owner Panel</title>
    <style>
        body { background: #020617; color: white; font-family: sans-serif; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .card { background: #1e293b; padding: 20px; border-radius: 12px; width: 100%; max-width: 500px; margin-bottom: 25px; border: 1px solid #334155; }
        h2 { color: #38bdf8; margin-top: 0; }
        input, textarea, select { width: 100%; padding: 12px; background: #0f172a; border: 1px solid #334155; color: white; border-radius: 8px; box-sizing: border-box; margin-bottom: 12px; }
        button { width: 100%; padding: 12px; background: #38bdf8; border: none; border-radius: 8px; color: #020617; font-weight: bold; cursor: pointer; }
        .staff-item { background: #0f172a; padding: 10px; border-radius: 8px; margin-top: 8px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #334155; }
        .del-btn { background: #ef4444; color: white; width: auto; padding: 5px 10px; font-size: 11px; }
    </style>
</head>
<body>

    <div class="card">
        <h2>üì¢ Post Official Update</h2>
        <form id="msgForm">
            <select id="msgType">
                <option value="üì¢ Announcement">Announcement</option>
                <option value="üìä Score Update">Score Update</option>
                <option value="üìù General Note">General Note</option>
            </select>
            <textarea id="msgText" placeholder="Your message here..." required></textarea>
            <button type="submit" id="msgBtn">Publish Update</button>
        </form>
    </div>

    <div class="card">
        <h2>üë• Add Staff Member</h2>
        <form id="staffForm">
            <input type="text" id="stName" placeholder="Username" required>
            <input type="number" id="stID" placeholder="User ID" required>
            <input type="text" id="stRole" placeholder="Role Name" required>
            <button type="submit" id="staffBtn">Add to Sheet</button>
        </form>
    </div>

    <div class="card">
        <h2>üõ†Ô∏è Manage Staff</h2>
        <div id="manageList">Loading...</div>
    </div>

    <script>
        const API = 'https://sheetdb.io/api/v1/nsqoeik98h24';

        // POST MESSAGE
        document.getElementById('msgForm').onsubmit = e => {
            e.preventDefault();
            document.getElementById('msgBtn').innerText = "Sending...";
            fetch(API + '?sheet=Sheet1', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({data: [{
                    type: document.getElementById('msgType').value,
                    message: document.getElementById('msgText').value,
                    date: new Date().toLocaleString()
                }]})
            }).then(() => { alert("Update Sent!"); location.reload(); });
        };

        // ADD STAFF
        document.getElementById('staffForm').onsubmit = e => {
            e.preventDefault();
            document.getElementById('staffBtn').innerText = "Saving...";
            fetch(API + '?sheet=staff', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({data: [{
                    name: document.getElementById('stName').value,
                    id: document.getElementById('stID').value,
                    role: document.getElementById('stRole').value,
                    date_added: new Date().toLocaleDateString()
                }]})
            }).then(() => { alert("Staff Saved!"); location.reload(); });
        };

        // LOAD STAFF LIST
        function loadStaff() {
            fetch(API + '?sheet=staff').then(res => res.json()).then(data => {
                const list = document.getElementById('manageList');
                // Filters out the header row if it accidentally shows up
                list.innerHTML = data.filter(s => s.name !== 'name').map(s => `
                    <div class="staff-item">
                        <div><b>${s.name}</b><br><small>${s.role}</small></div>
                        <button class="del-btn" onclick="deleteStaff('${s.name}')">Remove</button>
                    </div>
                `).join('');
            });
        }

        function deleteStaff(name) {
            if(confirm("Delete " + name + "?")) {
                fetch(`${API}/name/${name}?sheet=staff`, { method: 'DELETE' })
                .then(() => location.reload());
            }
        }
        loadStaff();
    </script>
</body>
</html>

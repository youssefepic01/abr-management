<!DOCTYPE html>
<html lang="en">
<head>
    <title>RP Admin | Ownership</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { 
            --bg: #0f172a; 
            --side: #020617; 
            --accent: #f43f5e; /* Red accent for Ownership */
            --text: #94a3b8; 
            --card-bg: #1e293b;
            --success: #10b981;
        }
        body { margin: 0; display: flex; height: 100vh; background: var(--bg); color: white; font-family: 'Inter', sans-serif; }
        
        /* Sidebar */
        .sidebar { width: 250px; background: var(--side); padding: 20px; border-right: 1px solid #334155; display: flex; flex-direction: column; flex-shrink: 0; }
        .logo { font-weight: bold; font-size: 1.2rem; margin-bottom: 30px; color: var(--accent); display: flex; align-items: center; gap: 10px; }
        .nav-item { padding: 12px; border-radius: 8px; color: var(--text); cursor: pointer; transition: 0.2s; margin-bottom: 5px; text-decoration: none; display: block; }
        .nav-item:hover { background: #1e293b; color: white; }
        .nav-item.active { background: var(--accent); color: white; }
        
        /* Main Area */
        .main { flex: 1; padding: 40px; overflow-y: auto; }
        .card { background: var(--card-bg); padding: 25px; border-radius: 12px; border: 1px solid #334155; display: none; }
        .card.active { display: block; }
        
        /* Tables */
        h2 { margin-top: 0; margin-bottom: 10px; }
        .subtitle { color: var(--text); font-size: 0.85rem; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: var(--accent); font-size: 12px; padding: 12px; border-bottom: 2px solid #334155; text-transform: uppercase; }
        td { padding: 12px; border-bottom: 1px solid #334155; font-size: 14px; }
        
        /* Badges & Buttons */
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; background: #334155; }
        .status-pending { color: #fbbf24; background: rgba(251, 191, 36, 0.1); }
        .btn-action { padding: 6px 12px; border-radius: 4px; border: none; cursor: pointer; font-size: 11px; font-weight: bold; margin-right: 5px; }
        .btn-approve { background: var(--success); color: white; }
        .btn-deny { background: #ef4444; color: white; }

        .demo-banner {
            background: #ef4444; color: white; padding: 8px; border-radius: 8px; 
            font-weight: 800; font-size: 10px; margin-bottom: 25px; text-align: center;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="demo-banner">OWNERSHIP CONSOLE</div>
        <div class="logo">üíé Ownership</div>
        
        <div class="nav-item active" onclick="showTab('requestsTab', this)">üì© Action Requests</div>
        <div class="nav-item" onclick="showTab('strikesTab', this)">‚öñÔ∏è Strike History</div>
        
        <a href="<div class="nav-item" onclick="window.location.href='/view/'">üìã View Database</div>" target="_blank" class="nav-item" style="margin-top: auto; border-top: 1px solid #334155; padding-top: 20px;">üåê Go to Public Site</a>
    </div>

    <div class="main">
        <div id="requestsTab" class="card active">
            <h2>Pending Action Requests</h2>
            <div class="subtitle">Approve or deny requests submitted by Leadership.</div>
            <div id="reqLoader">Fetching requests...</div>
            <table id="reqTable" style="display:none;">
                <thead>
                    <tr>
                        <th>Target Staff</th>
                        <th>Action</th>
                        <th>Reasoning</th>
                        <th>Status</th>
                        <th>Decision</th>
                    </tr>
                </thead>
                <tbody id="reqContent"></tbody>
            </table>
        </div>

        <div id="strikesTab" class="card">
            <h2>Global Strike Logs</h2>
            <div class="subtitle">Review all punishments issued across the department.</div>
            <div id="strikeLoader">Loading logs...</div>
            <table id="strikeTable" style="display:none;">
                <thead>
                    <tr>
                        <th>Staff Name</th>
                        <th>Level</th>
                        <th>Reason</th>
                        <th>Date Issued</th>
                    </tr>
                </thead>
                <tbody id="strikeContent"></tbody>
            </table>
        </div>
    </div>

    <script>
        const SHEETDB_API = 'https://script.google.com/macros/s/AKfycbyGipapObdry9qy39Zj1vY2_gRKRLm9KIDNqclRishFkhaBAutKVlcTYuuVPwnIpTwvyQ/exec';

        function showTab(tabId, el) {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            el.classList.add('active');
            
            if(tabId === 'requestsTab') { loadRequests(); }
            if(tabId === 'strikesTab') { loadStrikes(); }
        }

        async function loadRequests() {
            try {
                const res = await fetch(`${SHEETDB_API}?sheet=requests`);
                const data = await res.json();
                const content = document.getElementById('reqContent');
                
                content.innerHTML = data.map((row, index) => `
                    <tr>
                        <td><strong>${row.name || 'N/A'}</strong></td>
                        <td>${row.type || 'Action'}</td>
                        <td><small>${row.reason || 'No reason'}</small></td>
                        <td><span class="status-badge status-pending">${row.status || 'PENDING'}</span></td>
                        <td>
                            <button class="btn-action btn-approve" onclick="updateStatus('${row.name}', 'APPROVED')">‚úî</button>
                            <button class="btn-action btn-deny" onclick="updateStatus('${row.name}', 'DENIED')">‚úñ</button>
                        </td>
                    </tr>
                `).join('');
                
                document.getElementById('reqLoader').style.display = 'none';
                document.getElementById('reqTable').style.display = 'table';
            } catch (e) {
                document.getElementById('reqLoader').innerText = "Failed to load requests.";
            }
        }

        async function loadStrikes() {
            try {
                const res = await fetch(`${SHEETDB_API}?sheet=strikes`);
                const data = await res.json();
                const content = document.getElementById('strikeContent');
                
                content.innerHTML = data.map(row => `
                    <tr>
                        <td><strong>${row.name || 'Unknown'}</strong></td>
                        <td>${row.level || 'Warning'}</td>
                        <td>${row.reason || '-'}</td>
                        <td>${row.date || '-'}</td>
                    </tr>
                `).join('');
                
                document.getElementById('strikeLoader').style.display = 'none';
                document.getElementById('strikeTable').style.display = 'table';
            } catch (e) {
                document.getElementById('strikeLoader').innerText = "Failed to load logs.";
            }
        }

        // Simple function to simulate status update
        function updateStatus(name, decision) {
            alert(`${decision} for ${name}. (In a real setup, this would trigger a PATCH request to your SheetDB API)`);
        }

        // Initial Load
        loadRequests();
    </script>
</body>
</html>
